```mermaid
graph TD
    subgraph Mamba Block
        direction LR
        
        %% Step 1: Input Expansion & Gating
        Input_x[Input x] --> Linear_Expand[Linear Expansion];
        Linear_Expand --> |Split| Stream_z[z (Data Stream)];
        Linear_Expand --> |Split| Stream_gate[gate_x (Gate Stream)];
        
        %% Step 2: SSM Core Engine
        subgraph SSM Core Engine
            direction TB
            Stream_z_input[from z] --> Dynamic_Controller[Dynamic Controller (Linears)];
            Dynamic_Controller --> |generates| Param_Delta[Δ];
            Dynamic_Controller --> |generates| Param_B[B];
            Dynamic_Controller --> |generates| Param_C[C];

            State_Loop(Recurrent State S)
            State_Loop -- A (State Evolution) --> State_Loop
            
            Stream_z_input --> |B (Input Injection)| State_Loop;
            Param_B --> State_Loop;

            State_Loop --> |C (Output Projection)| Output_y[y (Engine Output)];
            Param_C --> Output_y;
        end

        Stream_z --> Stream_z_input;

        %% Step 3: Final Gating & Output
        Stream_gate --> SiLU[SiLU Activation];
        Output_y --> Multiply[⊗ Element-wise Multiply];
        SiLU --> Multiply;
        
        Multiply --> Linear_Compress[Linear Compression];
        Linear_Compress --> Final_Output[Final Output];
    end

    style Mamba Block fill:#f9f,stroke:#333,stroke-width:2px
    style SSM Core Engine fill:#bdf,stroke:#333,stroke-width:2px
```